##
title = "AJAX Framework"
url = "/ajax"
layout = "default"

[resources]
less[] = "pages/ajax.less"
==
<?
function onTest()
{
    $value1 = input('value1');
    $value2 = input('value2');
    $operation = input('operation');

    switch ($operation) {
        case '+' :
            $this['result'] = $value1 + $value2;
            break;
        case '-' :
            $this['result'] = $value1 - $value2;
            break;
        case '*' :
            $this['result'] = $value1 * $value2;
            break;
        default :
            $this['result'] = $value2 != 0 ? round($value1 / $value2, 2) : 'NaN';
            break;
    }

    Flash::success('You did it');
}

function onTestSelector()
{
    return ['=[data-anyselector]' => 'Success <span>Should Be Red</span>'];
}
?>
==
<div class="container">
    <h1>AJAX Tests</h1>

    <!-- Testing Custom Selector -->
    <div data-anyselector id="customSelector">
        Content Will Go Here
    </div>

    <form>
        <input type="hidden" name="input" value="1">
        <a
            href="#"
            data-request="onTestSelector"
            data-request-success="$('#customSelector > span').css('color', 'red')"
            >Test Custom Selector</a>
    </form>

    <!-- Testing Data Object from jQuery -->
    <script>
        function getChecked() { return [1,2,3]; }
    </script>
    <form>
        <input type="hidden" name="input" value="1">
        <a href="#"
        data-request="onAjax"
        onclick="$(this).data('request-data', { additional: getChecked() });"
        >Test Data Object</a>
    </form>

    <form>
        <input type="hidden" name="input" value="1">
        <a href="#"
            data-request="onAjax"
            onclick="console.log('clicked'); $(this).data('request-data', 'additional:1');"
        >Trigger Data String</a>
    </form>

    <form>
        <input type="hidden" name="input" value="1">
        <a href="#" id="target" data-request="onAjax"></a>

        <a href="javascript:runTest()">Trigger Click Event</a>
    </form>

    <script>
        function runTest() {
            console.log('Running Request');
            $('#target').data('request-data', 'additional:1').get(0).click();
        }
    </script>

    <form id="customEventForm">
        <input type="hidden" name="input" value="1">
        <a href="javascript:runCustomEvent()">Trigger Custom Event</a>
    </form>

    <script>
        function runCustomEvent() {
            console.log('Running Request');
            oc.request('#customEventForm', 'onAjax', { data: { additional: 1 } });
        }
    </script>
</div>

<hr />

<div class="container">
    <div class="row">
        <div class="col-xl-10 col-lg-12">
            <div class="panel">
                <div class="row">
                    <div class="col-lg-9 control-panel">
                        <div class="panel-body">
                            <form role="form" class="form-inline" data-request="onTest" data-request-update="calcresult: '#result'" data-request-flash>
                                <div class="form-group">
                                    <input type="text" class="form-control" value="15" name="value1">
                                </div>

                                <div class="form-group operation-buttons">
                                    <label><input type="radio" name="operation" value="+"><span>+</span></label>
                                    <label><input type="radio" name="operation" value="-"><span>-</span></label>
                                    <label><input type="radio" name="operation" value="*" checked><span>*</span></label>
                                    <label><input type="radio" name="operation" value="/"><span>/</span></label>
                                </div>

                                <div class="form-group">
                                    <input type="text" class="form-control" value="5" name="value2">
                                </div>

                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary">=</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-lg-3 ps-0">
                        <div id="result">{% partial "calcresult" %}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
